
@{
    ViewBag.Title = "Nominas";
    Layout = "~/Views/Layout/_Principal2_Oper.cshtml";
}

@section script{


    <script type="text/javascript">


        $(function () {

            $("#slPeriodo").on("change", function () {
                $("#tbl_ResTrabajadores").html("");
                $("#tbl_ResPensionados").html("");
                $("#tbl_ResCanales").html("");

                $.SecGetJSON(getReportalApiHost() + "api/resumenes-nominas/resumen-cascadas-pensionados?periodo=" + $("#slPeriodo").val(), function (respoonse) {
                   
                    var totales = { caen:0, pasan:0 };
                    $.each(respoonse, function (i, o) {
                        if (i === 0) {
                            $("#tbl_ResPensionados").append(
                                $("<tr>")
                                    .append($("<td>").html("Pensionados").attr("rowspan", respoonse.length + 1).css("text-align", "center").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1").css("vertical-align", "middle"))
                                    .append($("<td>").html(o.Filtro))
                                    .append($("<td>").html(o.Caen.toMoney()).css("text-align", "right"))
                                    .append($("<td>").html(o.Pasan.toMoney()).css("text-align", "right"))
                            );
                        } else {
                            $("#tbl_ResPensionados").append(
                                $("<tr>")
                                    .append($("<td>").html(o.Filtro))
                                    .append($("<td>").html(o.Caen.toMoney()).css("text-align", "right"))
                                    .append($("<td>").html(o.Pasan.toMoney()).css("text-align", "right"))
                            );
                        }

                        totales.caen = totales.caen + o.Caen;
                        totales.pasan = totales.caen + o.Pasan;

                    });
                    //foot
                    $("#tbl_ResPensionados").append(
                                $("<tr>")
                                    .append($("<td>").html("Total Pre Aprobados").css("text-align", "center").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                                    .append($("<td>").html(totales.caen.toMoney()).css("text-align", "right").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                                    .append($("<td>").html(totales.pasan.toMoney()).css("text-align", "right").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                        );

                });

                $.SecGetJSON(getReportalApiHost() + "api/resumenes-nominas/resumen-cascadas-trabajadores?periodo=" + $("#slPeriodo").val(), function (respoonse) {
                    
                    var totales = { caen: 0, pasan: 0 };
                    $.each(respoonse, function (i, o) {
                        if (i === 0) {
                            $("#tbl_ResTrabajadores").append(
                                $("<tr>")
                                    .append($("<td>").html("Trabajadores").attr("rowspan", respoonse.length + 1).css("text-align", "center").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1").css("vertical-align", "middle"))
                                    .append($("<td>").html(o.Filtro))
                                    .append($("<td>").html(o.Caen.toMoney()).css("text-align", "right"))
                                    .append($("<td>").html(o.Pasan.toMoney()).css("text-align", "right"))

                            );
                        } else {
                            $("#tbl_ResTrabajadores").append(
                                $("<tr>")
                                    .append($("<td>").html(o.Filtro))
                                    .append($("<td>").html(o.Caen.toMoney()).css("text-align", "right"))
                                    .append($("<td>").html(o.Pasan.toMoney()).css("text-align", "right"))
                            );
                        }

                        totales.caen = totales.caen + o.Caen;
                        totales.pasan = totales.caen + o.Pasan;

                    });
                    //foot
                    $("#tbl_ResTrabajadores").append(
                                $("<tr>")
                                    .append($("<td>").html("Total Pre Aprobados").css("text-align", "center").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                                    .append($("<td>").html(totales.caen.toMoney()).css("text-align", "right").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                                    .append($("<td>").html(totales.pasan.toMoney()).css("text-align", "right").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                        );
                });

                $.SecGetJSON(getReportalApiHost() + "api/resumenes-nominas/resumen-canales?periodo=" + $("#slPeriodo").val(), function (respoonse) {

                    $.each(respoonse, function (i, o) {
                        $("#tbl_ResCanales").append(
                            $("<tr>")
                                .append($("<td>").html(o.Canal))
                                .append($("<td>").html(o.Cantidad.toMoney()).css("text-align","right"))
                        );
                    });
                });

                $.SecGetJSON(getReportalApiHost() + "api/resumenes-nominas/resumen-nominas?periodo=" + $("#slPeriodo").val(), function (respoonse) {
                    var i = 0, canal = '';
                    $.each(respoonse.ResumenNominas, function (i, o) {
                        
                        if (canal != o.Canal) {
                            i = 0;
                        }

                        console.log(ObtenerRowspan(o.Canal, respoonse.RowsCanales));
                        if (ObtenerRowspan(o.Canal, respoonse.RowsCanales) <= 1) {
                            $("#tbl_ResNominas").append(
                                 $("<tr>")
                                    .append($("<td>").html(o.Canal).css("text-align", "center").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                                    .append($("<td>").html(o.Nomina))
                                    .append($("<td>").html(o.Cantidad.toMoney()).css("text-align", "right"))
                            );
                        }
                        else if (ObtenerRowspan(o.Canal, respoonse.RowsCanales) > 1 && i === 0)
                        {
                            $("#tbl_ResNominas").append(
                                $("<tr>")
                                   .append($("<td>").html(o.Canal).attr("rowspan", ObtenerRowspan(o.Canal, respoonse.RowsCanales)).css("vertical-align", "middle").css("text-align", "center").css("background", "#1f8fe0 none repeat scroll 0 0").css("color", "#fff1f1"))
                                   .append($("<td>").html(o.Nomina))
                                   .append($("<td>").html(o.Cantidad.toMoney()).css("text-align", "right"))
                            );
                            i++;
                        }
                        else if (ObtenerRowspan(o.Canal, respoonse.RowsCanales) > 1 && i > 0)
                        {
                            $("#tbl_ResNominas").append(
                                $("<tr>")
                                   .append($("<td>").html(o.Nomina))
                                   .append($("<td>").html(o.Cantidad.toMoney()).css("text-align", "right"))
                            );
                            i++;
                        }

                        canal = o.Canal;
                    });
                });
            });

            $.SecGetJSON(getReportalApiHost() + "api/FechaActualizacion/1/", function (respoonse) {
                $("#Leyend_FechaActualizacion").html(respoonse.ActualizacionLeyenda);
            });

            $("#slPeriodo").trigger("change");

        });


        function ObtenerRowspan(key, array) {
            var r = 0;
            $.each(array, function (i, o) {
                if (key === o.Canal) {
                    r = o.Cantidad
                }        
            });

            return r;
        }

    </script>
}

@section css{
    <!--Premium Line Icons [ OPTIONAL ]-->
    <link href="~/getstart/premium/icon-sets/icons/line-icons/premium-line-icons.css" rel="stylesheet">
}

<div class="boxed">
    <div class="row">
        <div class="col-lg-12">
            <div class="well well-sm">
                Seleccione Periodo:
                <select id="slPeriodo">
                    <option value="201612" selected="selected">Diciembre 2016</option>
                    <option value="201611">Noviembre 2016</option>
                    <option value="201610">Octubre 2016</option>
                    <option value="201609">Septiembre 2016</option>
                </select>

                <button class="btn-xs btn-default btn-icon">Descargar todo <i class="pli-folder-zip icon-lg"></i></button>

                <span style="float:right;"><strong>*Datos actualizados al:</strong> <span id="Leyend_FechaActualizacion">Martes, 18 de Octubre de 2016</span></span>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-lg-12">

            <!--Default Tabs (Left Aligned)-->
            <!--===================================================-->
            <div class="tab-base">

                <!--Nav Tabs-->
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#tab-resumen" aria-expanded="true">Resumen</a>
                    </li>
                </ul>

                <!--Tabs Content-->
                <div class="tab-content">
                    <div id="tab-resumen" class="tab-pane fade active in">
                        <div class="row">
                            <div class="col-xs-5">
                                <div class="panel">
                                    <div class="panel-heading">
                                        <h1 class="panel-title">Resumen Canal</h1>
                                    </div>
                                    <div class="panel-body">
                                        <table class="table table-charlee table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Canal</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">N</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbl_ResCanales"></tbody>
                                            
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-7">
                                <div class="panel">
                                    <div class="panel-heading">
                                        <h1 class="panel-title">Resumen Nóminas</h1>
                                    </div>
                                    <div class="panel-body">
                                        <table class="table table-charlee table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Canal</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Nómina</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">N</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbl_ResNominas"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="row">

                            <div class="panel">
                                <div class="panel-heading">
                                    <h1 class="panel-title">Resumen Cascadas</h1>
                                </div>
                                <div class="panel-body">
                                    <div class="col-lg-6">
                                        <table class="table table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Segmento</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Filtro</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Caen</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Pasan</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbl_ResPensionados"></tbody>
                                        </table>
                                    </div>
                                    <div class="col-lg-6">
                                        <table class="table table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Segmento</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Filtro</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Caen</th>
                                                    <th style="text-align:center; background: #1f8fe0 none repeat scroll 0 0; color:#fff1f1;">Pasan</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbl_ResTrabajadores"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            
                            

                        </div>
                    </div>

                </div>
            </div>
            <!--===================================================-->
            <!--End Default Tabs (Left Aligned)-->
            <!--Icon Tabs (Left Aligned)-->
            <!--===================================================-->


        </div>
    </div>
</div>
<!--===================================================-->
<!--End page content-->
